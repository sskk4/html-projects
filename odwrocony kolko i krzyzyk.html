<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kolko i krzyzyk</title>
    <meta name="author" content="Sebastian Kolański">


    <style>

        html
        {
            font-family:Arial;
            color:white;
            background-color:#111;
        }

        .result
        {
            font-size:30px;
            top: 5%;
        left: 50%;
        transform: translate(-50%, -5%);
            position:fixed;
            width:100%;
            z-index:250;
            margin-left:auto;
            margin-right: auto;
            text-align:center;
        
        }

        .result2
        {
            animation: 2s anim-popoutin;
        }

        .modal
        {
            top: 30%;
        left: 50%;
        transform: translate(-50%, -30%);
            position:fixed;
            z-index:250;
            margin-left:auto;
            margin-right: auto;
            width:310px;
            height: 310px;
        }

        .symbol
        {
            width:150px;
            height: 150px;
            font-size:80px;
            color:whitesmoke;
            background-color:#333;
            border: black 1px solid;
            cursor:pointer;
            transition:0.5s;
        }

        .symbol:hover
        {
            background-color:whitesmoke;
            color:black;
        }

        .plansza
        {
            top: 20%;
        left: 50%;
        transform: translate(-50%, -20%);
            position:fixed;
            z-index:250;
            margin-left:auto;
            margin-right: auto;
            width:310px;
            height: 310px;
            border:1px solid black;
           
        }
        
        .plansza-disabled {
  pointer-events: none; 
  opacity: 0; 
}

    .modal-hidden
    {
        pointer-events: none; 
  opacity: 0; 
    }

        .pole
        {
            font-size:80px;
            line-height: 100px;
            text-align:center;
            width: 100px;
           height: 100px;
           float:left;
           transition:0.5s;
        }

        .pole:hover
        {
            background-color:#222;
            cursor:pointer;
        }

        .pole1, .pole4
        {
            border-right:solid white;
            border-bottom: solid white;
        }
        
        .pole2, .pole5
        {
            border-bottom:solid white;
        }
        .pole3, .pole6
        {
            border-bottom:solid white;
            border-left:solid white;
        }

        .pole4
        {
            clear:both;
        }

        .pole7
        {
            border-right:solid white;
        }

        .pole8
        {
            border-right:solid white;
        }

        @keyframes ruch
        {
            0%{font-size:0px; }
            100%{font-size:80px; }
        }

        @keyframes anim-popoutin {
  0% {
    color: white;
    font-size:0;
    opacity: 0;
    text-shadow: 0 0 0 rgba(0, 0, 0, 0);
  }
  25% {
    color: red;
    font-size:50px;
    opacity: 1;
    text-shadow: 3px 10px 5px rgba(0, 0, 0, 0.5);
  }
  50% {
    color: white;
    font-size:30px;
    opacity: 1;
    text-shadow: 1px 0 0 rgba(0, 0, 0, 0);
  }
  100% {
    font-size:30px;
    opacity: 1;
    text-shadow: 1px 0 0 rgba(0, 0, 0, 0);
  }
}

        .animate {
  animation: ruch 1s;
}

.clicked {
  cursor: not-allowed; 
}
     
        .krzyzyk
        {
        animation:ruch 1s;
        }
        
    

    </style>
</head>
<body>
    
    <div class="modal">
        <div class="modal-content">
          <button class="symbol symbol-X">X</button>
          <button class="symbol symbol-O">O</button>
        </div>
      </div>
      
      <div class="wszystko">
        <div class="result"></div>
        <div class="gora"></div>
        <div class="plansza plansza-disabled">
          <div class="pole pole1"></div>
          <div class="pole pole2"></div>
          <div class="pole pole3"></div>
          <div class="pole pole4"></div>
          <div class="pole pole5"></div>
          <div class="pole pole6"></div>
          <div class="pole pole7"></div>
          <div class="pole pole8"></div>
          <div class="pole pole9"></div>
        </div>
        <div class="gracz"></div>
      </div>
      
      <script>
   const modal = document.querySelector('.modal');
        const cells = document.querySelectorAll('.pole');
        const plansza = document.querySelector('.plansza');
        const result = document.querySelector('.result');
        const gracz = document.querySelector('.gracz');
        let currentPlayer = {name: '', symbol: ''};
        let movesCounter = 0;
      
        const boardState = ['', '', '', '', '', '', '', '', ''];

        function startGame() {
          modal.classList.add('modal-hidden');
          plansza.classList.remove('plansza-disabled');

          if(isComputerPlaying == true)
          {
           currentPlayer = getOtherPlayer(currentPlayer);
            makeMove(currentPlayer);
            movesCounter++;
          currentPlayer = getOtherPlayer(currentPlayer);
          }
        }
      
        function handleSymbolButtonClick(event) {
          currentPlayer.symbol = event.target.textContent;
          console.log(currentPlayer.symbol)
          if (Math.random() < 0.5) {
    isComputerPlaying = false;
  } 
  else {
    isComputerPlaying = true;
  }
          startGame();
        }
      
        const symbols = document.querySelectorAll('.symbol');
        symbols.forEach(symbol => {
          symbol.addEventListener('click', handleSymbolButtonClick);
        });


        function isCellEmpty(index) {
  return cells[index].textContent === '';
}

function isBoardFull(board) {
  return board.every(cell => cell !== '');
}

        function blockBoard() {
  plansza.classList.add('blocked');
}

        function unblockBoard() {
  plansza.classList.remove('blocked');
}

function checkGameOver() {
  movesCounter++;

  console.log(movesCounter);

  const winner = checkForWinner(boardState);
checkWinorDraw(winner);

  if(isComputerPlaying==true)
  {
    currentPlayer = getOtherPlayer(currentPlayer);
    makeMove(currentPlayer);
  }

  const winner2 = checkForWinner(boardState);
checkWinorDraw(winner2);

  if(isComputerPlaying==false)
  {
    currentPlayer = getOtherPlayer(currentPlayer);
    makeMove(currentPlayer);
  }

  return false;
}

function checkWinorDraw(winner)
{
  if (winner) {
    console.log(`${getOtherPlayer(currentPlayer).name} wygrał!`);
    result.textContent = `${getOtherPlayer(currentPlayer).name} wygrywa!`;
    result.classList.add('result2');
    setTimeout(() => {
      result.classList.remove('result2');
    }, 1000);
    isGameOver = true;
    blockBoard();
    return true;
  } else if (isBoardFull(boardState)) {
    console.log('Remis!');
    result.textContent = `Remis!`;
    result.classList.add('result2');
    setTimeout(() => {
      result.classList.remove('result2');
    }, 1000);
    isGameOver = true;
    blockBoard();
    return true;
  }
}

function makeMove(player) {
  
  const bestMoveIndex = findBestMove(boardState, player.symbol);
  boardState[bestMoveIndex] = player.symbol;
  setSymbolInCell(bestMoveIndex, player.symbol);
  const winner = checkForWinner(boardState);
  checkWinorDraw(winner);
}



symbols.forEach(symbol => {
      symbol.addEventListener('click', () => {
        modal.classList.add('modal-hidden');
        plansza.classList.remove('plansza-disabled');
        // Rozpoczęcie gry
      });
    });


cells.forEach((cell, index) => {
  cell.addEventListener('click', () => {
    if (plansza.classList.contains('blocked')) {
      return;
    }


    if (!isCellEmpty(index)) {
      console.log('To pole jest już zajęte');
      return;
    }

    
    setSymbolInCell(index, currentPlayer.symbol);
    checkGameOver();
    currentPlayer = getOtherPlayer(currentPlayer);

    
    
  });
});

function getOtherPlayer(currentPlayer) {
  return currentPlayer.symbol === 'X' ? {name: 'Kółko', symbol: 'O'} : {name: 'Krzyżyk', symbol: 'X'};
}



function setSymbolInCell(cellIndex, symbol){
  const cell = cells[cellIndex];
  cell.textContent = symbol;
  cell.classList.add('animate', 'clicked');

setTimeout(() => {
  cell.classList.remove('animate');
}, 1000);
  boardState[cellIndex] = symbol;
}


function checkForWinner(board) {
  // Sprawdzenie wierszy
  for (let i = 0; i < 9; i += 3) {
    if (board[i] !== '' && board[i] === board[i + 1] && board[i + 1] === board[i + 2]) {
      return board[i];
    }
  }

  // Sprawdzenie kolumn
  for (let i = 0; i < 3; i++) {
    if (board[i] !== '' && board[i] === board[i + 3] && board[i + 3] === board[i + 6]) {
      return board[i];
    }
  }

  // Sprawdzenie przekątnych
  if (board[0] !== '' && board[0] === board[4] && board[4] === board[8]) {
    return board[0];
  }
  if (board[2] !== '' && board[2] === board[4] && board[4] === board[6]) {
    return board[2];
  }

  // Brak zwycięzcy
  return null;
}

function findBestMove(board, playerSymbol) {
  let bestScore = -Infinity;
  let bestMove;

  for (let i = 0; i < board.length; i++) {
  if (board[i] === '') {
    board[i] = playerSymbol;

    let hasThreeInRow = checkThreeInRow(board, playerSymbol);

    board[i] = '';

    if (!hasThreeInRow || movesCounter==5) {
      let score = minimax(board, false, playerSymbol);

      if (score > bestScore) {
        bestScore = score;
        bestMove = i;
      }
    }
  }
}

  return bestMove;
}


function minimax(board, isMaximizing, playerSymbol) {
  let result = checkForWinner(board);

  if (result !== null) {
    if (result === playerSymbol) {
      return 1;
    } else if (result === getOtherPlayer({symbol: playerSymbol}).symbol) {
      return -1;
    } else {
      return 0;
    }
  }

  if (isMaximizing) {
    let bestScore = -Infinity;

    for (let i = 0; i < board.length; i++) {
      if (board[i] === '') {
        board[i] = playerSymbol;

        let score = minimax(board, false, playerSymbol);

        board[i] = '';

        if (score === 1) {
          return score;
        } else if (score === 0) {
          bestScore = score;
        }
      }
    }

    return bestScore;
  } else {
    let bestScore = Infinity;

    for (let i = 0; i < board.length; i++) {
      if (board[i] === '') {
        board[i] = getOtherPlayer({symbol: playerSymbol}).symbol;

        let score = minimax(board, true, playerSymbol);

        board[i] = '';

        if (score === -1) {
          return score;
        } else if (score === 0) {
          bestScore = score;
        }
      }
    }

    return bestScore;
  }
}

//funkcja sprawdza czy jest możliwość postawienia trzech symboli w linii, jeśli tak, odrzuca ten ruch
function checkThreeInRow(board, playerSymbol) {
  const winningCombinations = [
    [0, 1, 2], [3, 4, 5], [6, 7, 8], 
    [0, 3, 6], [1, 4, 7], [2, 5, 8], 
    [0, 4, 8], [2, 4, 6]             
  ];

  for (let i = 0; i < winningCombinations.length; i++) {
    const [a, b, c] = winningCombinations[i];
    if (board[a] === playerSymbol && board[b] === playerSymbol && board[c] === playerSymbol) {
      return true;
    }
  }
  return false;
}

  </script>
    
</body>
</html>